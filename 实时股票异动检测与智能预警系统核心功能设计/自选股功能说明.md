# 🌟 自选股功能说明

## 💡 为什么要用自选股？

### ❌ 之前的问题
- 一次性获取所有5000只股票 → **太大了！**
- Tushare免费版限制严格（每小时1次）→ **很容易超限！**
- 数据库存储大量无用数据 → **浪费空间！**
- 个人用户不需要关注所有股票 → **没必要！**

### ✅ 自选股的优势
- 只添加您关注的股票 → **精准高效！**
- 只获取和存储自选股数据 → **节省资源！**
- 避免频繁调用Tushare API → **不会超限！**
- 更符合个人使用习惯 → **用户友好！**

---

## 🚀 功能特点

### 1. 自选股管理
- ✅ 手动添加股票代码
- ✅ 设置股票备注
- ✅ 删除不关注的股票
- ✅ 查看最后同步时间

### 2. 数据同步
- ✅ 单只股票同步
- ✅ 批量同步所有自选股
- ✅ 只在需要时调用Tushare
- ✅ 数据自动缓存到数据库

### 3. K线图展示
- ✅ 点击股票查看K线图
- ✅ 60个交易日历史数据
- ✅ 双Y轴（价格+成交量）
- ✅ 专业图表展示

---

## 📋 使用流程

### 步骤1: 添加自选股

**方式A: 直接输入股票代码**
```
1. 点击"添加"按钮
2. 输入股票代码（例如: 000001.SZ）
3. 输入股票名称（选填）
4. 添加备注（选填）
5. 点击"确认添加"
```

**常见股票代码格式**:
- 深圳市场：`000001.SZ`、`002594.SZ`、`300750.SZ`
- 上海市场：`600000.SH`、`601318.SH`、`688981.SH`

**推荐添加的股票**（示例）:
```
000001.SZ - 平安银行
600036.SH - 招商银行
000858.SZ - 五粮液
600519.SH - 贵州茅台
000333.SZ - 美的集团
```

---

### 步骤2: 同步数据

**自动同步**:
- 第一次点击股票查看K线图时
- 系统会自动从Tushare获取数据
- 并保存到数据库

**手动同步**:
```
1. 点击"同步"按钮
2. 系统会同步所有自选股的最新数据
3. 等待同步完成
```

---

### 步骤3: 查看K线图

```
1. 在自选股列表中点击任意股票
2. 右侧显示K线图
3. 鼠标悬停查看详细信息
```

---

## 🎯 实际使用示例

### 场景1: 个人投资者

**小明的自选股**:
```
1. 添加5只关注的股票：
   - 000001.SZ (平安银行)
   - 600036.SH (招商银行)
   - 000858.SZ (五粮液)
   - 600519.SH (贵州茅台)
   - 000333.SZ (美的集团)

2. 点击"同步"获取最新数据
   → 只调用5次Tushare API（每天配额足够）

3. 每天查看K线图
   → 直接从数据库读取，秒级响应
   → 不再调用Tushare API

4. 每周更新一次数据
   → 保持数据最新
```

**优势**:
- ✅ 数据量小（5只股票 × 60天 = 300条记录）
- ✅ 不会超过API限制
- ✅ 响应速度快
- ✅ 专注关注的股票

---

### 场景2: 行业研究

**研究银行板块**:
```
添加所有银行股：
- 平安银行 (000001.SZ)
- 招商银行 (600036.SH)
- 兴业银行 (601166.SH)
- 民生银行 (600016.SH)
- 浦发银行 (600000.SH)
- 中信银行 (601998.SH)
...（约20只）

备注：添加备注区分（大型/中小型银行）
```

**数据对比**:
- 点击不同银行查看K线图
- 对比涨跌趋势
- 研究行业规律

---

## 🔧 API接口说明

### 1. 获取自选股列表
```
GET /api/watchlist
```

**响应示例**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "ts_code": "000001.SZ",
      "name": "平安银行",
      "note": "长期关注",
      "added_at": "2025-09-30T16:00:00",
      "last_sync": "2025-09-30T16:30:00"
    }
  ],
  "total": 1
}
```

---

### 2. 添加自选股
```
POST /api/watchlist
{
  "ts_code": "000001.SZ",
  "name": "平安银行",
  "note": "长期关注"
}
```

---

### 3. 删除自选股
```
DELETE /api/watchlist/{id}
```

---

### 4. 同步所有自选股数据
```
POST /api/watchlist/sync-all
{
  "start_date": "20250601",
  "end_date": "20250930"
}
```

---

## 💾 数据存储

### 数据库表结构

**watchlist表**（自选股列表）:
```sql
id          INT           主键
ts_code     VARCHAR(20)   股票代码（唯一）
symbol      VARCHAR(10)   简称
name        VARCHAR(50)   股票名称
note        VARCHAR(200)  用户备注
added_at    DATETIME      添加时间
last_sync   DATETIME      最后同步时间
```

**特点**:
- 每个用户只存储关注的股票
- 通常 5-50 只股票
- 数据量非常小（KB级别）

---

## 📊 数据量对比

### ❌ 全量股票模式
```
股票列表: 5000只 → 约5MB
日线数据: 5000只 × 250天 = 125万条 → 约500MB/年
总计: 约500MB+
```

### ✅ 自选股模式
```
自选股列表: 10只 → 约10KB
日线数据: 10只 × 250天 = 2500条 → 约1MB/年
总计: 约1MB
```

**节省空间**: 99.8%！

---

## ⚠️ 注意事项

### 1. 股票代码格式
- **深圳市场**: 以 `.SZ` 结尾
  - 主板: 000xxx.SZ
  - 中小板: 002xxx.SZ
  - 创业板: 300xxx.SZ

- **上海市场**: 以 `.SH` 结尾
  - 主板: 600xxx.SH
  - 科创板: 688xxx.SH

### 2. Tushare限制
即使使用自选股，仍需注意：
- `stock_basic`: 每小时1次
- `daily`: 每分钟有限制
- 建议每天同步1-2次即可

### 3. 数据更新频率
- **日常**: 从数据库读取，不调用API
- **每周**: 同步一次最新数据
- **月度**: 可以强制全量更新

---

## 🎨 界面预览

```
┌──────────────────────────────────────────────────────┐
│  我的自选股 [5] [同步] [添加]                         │
├──────────────────────────────────────────────────────┤
│  [添加表单]                                           │
│  股票代码: [000001.SZ    ]                           │
│  股票名称: [平安银行      ]                           │
│  备注:     [长期关注      ]                           │
│  [确认添加] [取消]                                    │
├──────────────────────────────────────────────────────┤
│  平安银行 ✓                                   [删除]  │
│  000001.SZ                                            │
│  💡 长期关注                                          │
│  🔄 2025-09-30 16:30:00                              │
├──────────────────────────────────────────────────────┤
│  招商银行                                     [删除]  │
│  600036.SH                                            │
│  💡 银行板块                                          │
└──────────────────────────────────────────────────────┘
```

---

## 🌟 最佳实践

### 1. 合理添加自选股
- ✅ 添加真正关注的股票（5-20只）
- ✅ 按行业或主题分类
- ✅ 使用备注标记重点
- ❌ 不要添加过多股票（>50只）

### 2. 同步频率建议
- **日内**: 不需要同步（查看缓存数据）
- **收盘后**: 同步一次获取最新数据
- **周末**: 无需同步（不是交易日）

### 3. 数据管理
- 定期清理不关注的股票
- 更新股票备注
- 查看最后同步时间

---

## 🔮 后续计划

### 功能增强
- [ ] 自选股分组（成长股、价值股等）
- [ ] 批量导入股票代码
- [ ] 导出自选股列表
- [ ] 股票价格预警

### 性能优化
- [ ] 自动定时同步
- [ ] 增量更新（只更新最新几天）
- [ ] 批量操作优化

---

## 📞 常见问题

### Q1: 如何快速添加多只股票？
A: 暂时需要一只一只添加，后续会增加批量导入功能

### Q2: 最多可以添加多少只股票？
A: 理论上没有限制，但建议控制在50只以内，保持专注

### Q3: 删除自选股会删除历史数据吗？
A: 目前不会删除历史数据，只是从自选股列表中移除

### Q4: 同步失败怎么办？
A: 可能是超过API限制，等待一段时间后重试

---

**完成时间**: 2025年9月30日  
**版本**: v2.0 - 自选股模式  
**状态**: ✅ 已实现
