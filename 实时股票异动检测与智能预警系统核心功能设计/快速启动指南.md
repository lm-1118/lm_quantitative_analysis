# 🚀 快速启动指南

## 项目架构说明

本项目采用**完全前后端分离**架构：

- **前端**: React + Vite + Tailwind CSS (位于 `web/` 目录)
- **后端**: Flask + REST API + WebSocket (位于 `app/` 目录)
- **旧前端**: 已弃用，不再使用 `templates/` 目录下的HTML模板

---

## 📦 第一步：安装后端依赖

在项目根目录下运行：

```bash
pip install -r requirements_minimal.txt
```

**主要依赖说明**：
- ✅ Flask 及相关扩展（Web框架）
- ✅ Flask-SocketIO（WebSocket支持）
- ✅ SQLAlchemy（数据库ORM）
- ✅ Tushare（股票数据源）
- ✅ PyMySQL（MySQL数据库驱动）

---

## 🗄️ 第二步：初始化数据库

运行数据库初始化脚本：

```bash
python init_datasource_db.py
```

**这个脚本会**：
1. 创建 `data_source_config` 表
2. 添加默认的Tushare Pro配置（未激活）
3. 添加默认的Yahoo Finance配置（未激活）

**预期输出**：
```
✅ 数据源配置表创建成功
✅ 默认数据源配置创建成功
```

如果已经初始化过，会显示：
```
ℹ️ 数据源配置已存在，跳过初始化
```

---

## 🔧 第三步：配置检查

### 检查数据库配置

确认 `config.py` 中的数据库连接信息：

```python
DB_HOST = 'localhost'
DB_USER = 'root'
DB_PASSWORD = '20050204Ylm'  # 您的数据库密码
DB_NAME = 'stock'
```

### 检查前后端分离配置

确认 `config.py` 中：

```python
ENABLE_LEGACY_TEMPLATES = False  # ✅ 已设置为False，不使用旧模板
```

---

## 🎯 第四步：启动后端服务

```bash
python run.py
```

**后端服务信息**：
- API地址: `http://localhost:5000/api`
- WebSocket地址: `ws://localhost:5000`
- 支持CORS: `http://localhost:5173` (Vite开发服务器)

**成功标志**：
```
* Running on http://localhost:5000
* Restarting with stat
```

---

## 💻 第五步：启动前端服务

在新的终端窗口中：

```bash
cd web
pnpm install  # 如果还没安装依赖
pnpm dev
```

**前端服务信息**：
- 开发地址: `http://localhost:5173`
- 框架: Vite + React 18
- UI库: Shadcn/UI + Tailwind CSS

**成功标志**：
```
VITE v5.4.20  ready in XXX ms
➜  Local:   http://localhost:5173/
```

---

## ✅ 验证安装

### 1. 测试后端API

打开浏览器访问：
```
http://localhost:5000/api/datasources
```

应该返回JSON数据：
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "source_type": "tushare",
      "source_name": "Tushare Pro",
      "is_active": false,
      ...
    }
  ]
}
```

### 2. 测试前端页面

打开浏览器访问：
```
http://localhost:5173
```

应该看到股票异动检测与智能预警系统的主界面。

---

## 🔑 配置Tushare数据源

### 方法1：通过前端界面配置

1. 访问 `http://localhost:5173`
2. 点击"数据源"标签页
3. 输入您的Tushare Token
4. 点击"测试连接"
5. 测试成功后，点击"激活"

### 方法2：通过API直接配置

使用工具如Postman或curl：

```bash
curl -X PUT http://localhost:5000/api/datasources/1 \
  -H "Content-Type: application/json" \
  -d '{
    "config_data": {
      "token": "YOUR_TUSHARE_TOKEN_HERE"
    },
    "is_active": true,
    "is_default": true
  }'
```

### 获取Tushare Token

1. 访问 https://tushare.pro/
2. 注册账号（免费）
3. 在个人中心获取Token
4. 免费版足够个人使用

---

## 📚 API文档

详细的API接口说明请查看：
- [API接口汇总](./API_ROUTES_SUMMARY.md)
- [前后端分离架构说明](./FRONTEND_BACKEND_SEPARATION.md)

---

## 🐛 常见问题

### Q1: 数据库连接失败？

**错误**: `Can't connect to MySQL server`

**解决**:
1. 确认MySQL服务已启动
2. 检查 `config.py` 中的数据库配置
3. 确认数据库 `stock` 已创建

```sql
CREATE DATABASE IF NOT EXISTS stock CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### Q2: 前端无法访问后端API？

**错误**: `CORS policy: No 'Access-Control-Allow-Origin'`

**解决**:
1. 确认后端已启动
2. 检查 `app/__init__.py` 中的CORS配置
3. 确认前端运行在 `localhost:5173`

### Q3: WebSocket连接失败？

**错误**: `WebSocket connection failed`

**解决**:
1. 确认已安装 `eventlet`: `pip install eventlet`
2. 确认后端使用 `python run.py` 启动（而不是 `flask run`）
3. 检查防火墙设置

### Q4: Tushare Token无效？

**错误**: `Token未设置或无效`

**解决**:
1. 确认Token已正确复制（不要有空格）
2. 确认在Tushare官网已激活Token
3. 尝试在Tushare官网重新生成Token

### Q5: 导入错误？

**错误**: `ModuleNotFoundError: No module named 'xxx'`

**解决**:
```bash
pip install -r requirements_minimal.txt
```

---

## 📊 项目目录结构

```
lm_quantitative_analysis/
├── app/                          # 后端应用
│   ├── api/                      # REST API接口（新）
│   │   ├── datasource_routes.py # 数据源配置API
│   │   ├── stock_routes.py      # 股票数据API
│   │   └── alert_routes.py      # 预警规则API
│   ├── models/                   # 数据模型
│   │   └── data_source_config.py
│   ├── services/                 # 业务服务
│   │   └── tushare_service.py   # Tushare数据服务
│   ├── websocket/               # WebSocket事件
│   ├── routes/                  # 旧路由（已禁用）
│   └── templates/               # 旧模板（已弃用）
├── web/                         # 前端应用（新）
│   ├── src/
│   │   ├── components/
│   │   │   ├── ui/             # Shadcn UI组件
│   │   │   └── StockDashboard.jsx
│   │   ├── App.jsx
│   │   └── main.jsx
│   ├── package.json
│   └── vite.config.js
├── config.py                    # 配置文件
├── run.py                       # 启动脚本
├── init_datasource_db.py        # 数据库初始化
└── requirements_minimal.txt     # 依赖清单
```

---

## 🎓 下一步学习

1. **阅读API文档**: [API_ROUTES_SUMMARY.md](./API_ROUTES_SUMMARY.md)
2. **了解架构**: [FRONTEND_BACKEND_SEPARATION.md](./FRONTEND_BACKEND_SEPARATION.md)
3. **查看详细设计**: [基于WebSocket的实时股票异动检测与智能预警系统.md](./基于WebSocket的实时股票异动检测与智能预警系统.md)

---

## 💡 开发提示

### 后端开发

- API接口都在 `app/api/` 目录下
- 添加新接口后需要在 `app/api/__init__.py` 中导入
- 数据模型放在 `app/models/` 目录下
- 业务逻辑放在 `app/services/` 目录下

### 前端开发

- 组件放在 `web/src/components/` 目录下
- API调用建议封装在单独的service文件中
- 使用Shadcn/UI组件库（已配置好）
- 支持Tailwind CSS类名

### WebSocket开发

- 事件处理在 `app/websocket/websocket_events.py`
- 前端使用 `socket.io-client` 连接
- 支持订阅/取消订阅机制

---

**祝您使用愉快！** 🎉

如有问题，请查看项目文档或提Issue。
