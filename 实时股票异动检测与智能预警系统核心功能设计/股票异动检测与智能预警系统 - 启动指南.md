# 股票异动检测与智能预警系统 - 启动指南

## 系统要求

### 环境依赖
- **Python**: 3.11 或更高版本
- **Node.js**: 18.0 或更高版本
- **pnpm**: 最新版本（推荐）或 npm/yarn

### 系统兼容性
- **操作系统**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

## 快速启动

### 1. 后端服务启动

```bash
# 进入后端项目目录
cd stock_alert_system

# 创建Python虚拟环境
python3.11 -m venv venv

# 激活虚拟环境
# Linux/macOS:
source venv/bin/activate
# Windows:
# venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 启动Flask API服务器（后台运行）
python src/main.py &

# 启动WebSocket数据服务器（后台运行）
python fixed_demo_server.py &
```

### 2. 前端应用启动

```bash
# 进入前端项目目录
cd stock-alert-frontend

# 安装依赖
pnpm install

# 启动开发服务器
pnpm run dev
```

### 3. 访问系统

在浏览器中访问：`http://localhost:5173`

## 详细配置说明

### 后端配置

#### Flask API服务器
- **端口**: 5000
- **功能**: 提供RESTful API接口
- **配置文件**: `src/main.py`

#### WebSocket服务器
- **端口**: 8765
- **功能**: 实时数据推送
- **配置文件**: `fixed_demo_server.py`

### 前端配置

#### 开发服务器
- **端口**: 5173
- **框架**: React 18 + Vite
- **配置文件**: `vite.config.js`

## 功能模块说明

### 1. 实时监控
- 显示股票实时价格、涨跌幅、成交量等信息
- WebSocket连接状态监控
- 支持的股票：AAPL, GOOGL, MSFT, TSLA, AMZN

### 2. 预警记录
- 查看历史预警信息
- 预警级别分类（高/中/低）
- 预警时间和详细信息

### 3. 预警规则
- 创建和管理个性化预警规则
- 设置价格、涨跌幅、成交量阈值
- 启用/禁用规则管理

### 4. 数据源配置
- 支持Tushare Pro和Yahoo Finance
- 数据源连接测试
- 主数据源切换

### 5. 策略配置
- 价格动量策略
- 均值回归策略
- 成交量分析策略
- 技术指标策略

### 6. Webhook通知
- 钉钉机器人通知
- 企业微信通知
- Slack通知
- Telegram通知
- 邮件通知

## 故障排除

### 常见问题

#### 1. WebSocket连接失败
**症状**: 前端显示"请确保WebSocket服务器正在运行"

**解决方案**:
```bash
# 检查WebSocket服务器是否运行
ps aux | grep python | grep fixed_demo_server

# 如果没有运行，重新启动
cd stock_alert_system
source venv/bin/activate
python fixed_demo_server.py &
```

#### 2. 前端编译错误
**症状**: 前端启动时出现编译错误

**解决方案**:
```bash
# 清除缓存并重新安装依赖
cd stock-alert-frontend
rm -rf node_modules
rm pnpm-lock.yaml
pnpm install
pnpm run dev
```

#### 3. 端口占用问题
**症状**: 端口已被占用的错误信息

**解决方案**:
```bash
# 查找占用端口的进程
sudo lsof -i :5000  # Flask端口
sudo lsof -i :8765  # WebSocket端口
sudo lsof -i :5173  # 前端端口

# 终止占用进程
sudo kill -9 <PID>
```

#### 4. Python依赖问题
**症状**: 模块导入错误

**解决方案**:
```bash
# 确保在虚拟环境中
source venv/bin/activate

# 重新安装依赖
pip install --upgrade pip
pip install -r requirements.txt

# 如果requirements.txt不存在，手动安装
pip install flask flask-cors websockets asyncio
```

### 日志查看

#### 后端日志
```bash
# Flask服务器日志
tail -f flask_server.log

# WebSocket服务器日志
tail -f websocket_server.log
```

#### 前端日志
- 打开浏览器开发者工具（F12）
- 查看Console标签页的日志信息

## 开发模式

### 热重载开发

#### 后端热重载
```bash
# 使用Flask开发模式
export FLASK_ENV=development
export FLASK_DEBUG=1
python src/main.py
```

#### 前端热重载
```bash
# Vite自动支持热重载
pnpm run dev
```

### 代码修改

#### 添加新股票
修改 `fixed_demo_server.py` 中的 `STOCKS` 字典：
```python
STOCKS = {
    'AAPL': {'name': 'Apple Inc.', 'base_price': 175.0},
    'GOOGL': {'name': 'Alphabet Inc.', 'base_price': 140.0},
    # 添加新股票
    'NVDA': {'name': 'NVIDIA Corp.', 'base_price': 450.0},
}
```

#### 修改更新频率
修改 `fixed_demo_server.py` 中的睡眠时间：
```python
await asyncio.sleep(5)  # 改为其他秒数
```

## 生产环境部署

### 使用Docker部署

#### 1. 构建Docker镜像
```bash
# 后端镜像
docker build -t stock-alert-backend ./stock_alert_system

# 前端镜像
docker build -t stock-alert-frontend ./stock-alert-frontend
```

#### 2. 运行容器
```bash
# 启动后端服务
docker run -d -p 5000:5000 -p 8765:8765 stock-alert-backend

# 启动前端服务
docker run -d -p 3000:3000 stock-alert-frontend
```

### 使用PM2部署

#### 1. 安装PM2
```bash
npm install -g pm2
```

#### 2. 配置PM2
创建 `ecosystem.config.js`:
```javascript
module.exports = {
  apps: [
    {
      name: 'flask-api',
      script: 'src/main.py',
      cwd: './stock_alert_system',
      interpreter: './venv/bin/python'
    },
    {
      name: 'websocket-server',
      script: 'fixed_demo_server.py',
      cwd: './stock_alert_system',
      interpreter: './venv/bin/python'
    }
  ]
}
```

#### 3. 启动服务
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## 性能优化

### 后端优化
- 使用Redis缓存频繁访问的数据
- 实现数据库连接池
- 使用异步处理提高并发能力

### 前端优化
- 启用代码分割和懒加载
- 使用CDN加速静态资源
- 实现虚拟滚动优化长列表

## 安全配置

### HTTPS配置
```bash
# 生成SSL证书
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365

# 配置Flask使用HTTPS
app.run(host='0.0.0.0', port=5000, ssl_context=('cert.pem', 'key.pem'))
```

### CORS配置
确保 `src/main.py` 中正确配置了CORS：
```python
from flask_cors import CORS
CORS(app, origins=['http://localhost:5173', 'https://yourdomain.com'])
```

## 监控和维护

### 系统监控
- 使用Prometheus + Grafana监控系统性能
- 设置日志轮转避免磁盘空间不足
- 定期备份重要数据

### 定期维护
- 每周检查系统日志
- 每月更新依赖包
- 每季度进行性能评估

## 技术支持

如果在使用过程中遇到问题，请：

1. 首先查看本指南的故障排除部分
2. 检查系统日志获取详细错误信息
3. 访问项目文档获取更多技术细节
4. 联系技术支持：https://help.manus.im

---

**最后更新**: 2025年9月29日  
**版本**: v1.0  
**维护团队**: Manus AI

